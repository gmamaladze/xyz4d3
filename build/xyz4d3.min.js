(function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.xyz4d3=e()})(this,function(){"use strict";function t(t){return t.join(" ")}function e(t){return Array.isArray(t)?t:[t.x,t.y,t.z]}function r(){}function n(t){var e=t.position?t.position:[0,0,0],r=t.size?t.size:[20,20,20];let n=document.createElement("transform");n.setAttribute("translation",y.encodePos(e));let o=document.createElement("shape");n.appendChild(o);let a=document.createElement("appearance"),i=document.createElement("material");i.setAttribute("diffusecolor","white"),a.appendChild(i),o.appendChild(a);let s=document.createElement("box");return s.setAttribute("size",y.encodePos(r)),o.appendChild(s),n}function o(t){var e=t.height?t.height:1,r=t.xbottom?t.xbottom:0,n=t.ybottom?t.ybottom:0,o=t.xtop?t.xtop:1,a=t.ytop?t.ytop:1;let i=document.createElement("transform");i.setAttribute("translation","0 0 0");let s=document.createElement("shape");i.appendChild(s);let c=document.createElement("appearance"),l=document.createElement("material");l.setAttribute("diffusecolor","0.8 0.8 0.2"),l.setAttribute("transparency","0.8"),c.appendChild(l),s.appendChild(c);let u=document.createElement("pyramid");return u.setAttribute("height",e),u.setAttribute("xbottom",r),u.setAttribute("ybottom",n),u.setAttribute("xtop",o),u.setAttribute("ytop",a),u.setAttribute("xoff",0),u.setAttribute("yoff",0),s.appendChild(u),i}function a(t){let e=document.createElement("transform"),r=document.createElement("shape"),n=document.createElement("lineset");n.setAttribute("vertexcount",t.length),n.setAttribute("solid","true");let o=document.createElement("coordinate");o.setAttribute("point",t.map(y.encodePos).join(" ")),n.appendChild(o),r.appendChild(n);let a=document.createElement("appearance"),i=document.createElement("material");return i.setAttribute("emissivecolor","1 1 1"),i.setAttribute("transparency","1"),a.appendChild(i),r.appendChild(a),r.setAttribute("isPickable","false"),e.appendChild(r),e}function i(t){let e=document.createElement("transform");e.setAttribute("translation","0 0 0");let r=document.createElement("transform");return r.setAttribute("rotation","0 1 0 0"),r.appendChild(s(t)),e.appendChild(r),e}function s(t){let e=document.createElement("shape"),r=document.createElement("appearance"),n=document.createElement("material");n.setAttribute("diffusecolor","0 0 0"),r.appendChild(n),e.appendChild(r);let o=document.createElement("text");o.setAttribute("string",t.text),o.setAttribute("solid","true");let a=document.createElement("fontstyle");return a.setAttribute("family","monospace"),a.setAttribute("size","10"),a.setAttribute("justify","middle"),a.setAttribute("quality","0"),o.appendChild(a),e.appendChild(o),e}function c(t){return new x3dom.fields.SFVec3f(t.x,t.y,t.z)}function l(t){let e=c(t[0]),r=c(t[1]);return e.subtract(r).length()}function u(t){let e=c(t[0]),r=c(t[1]),n=e.subtract(r);var o=n.length();let a=Math.acos(n.x/o);Math.acos(n.y/o),Math.acos(n.z/o);var i=x3dom.fields.SFMatrix4f.rotationX(a);return y.encodePos(i.toGL())}function p(t){return y.encodePos(t[0])}function d(t){let e=l(t),r=document.createElement("transform"),n=document.createElement("shape"),o=document.createElement("cylinder");o.setAttribute("height",e),o.setAttribute("solid","true"),o.setAttribute("radius","10"),n.appendChild(o);let a=document.createElement("appearance"),i=document.createElement("material");return a.appendChild(i),n.appendChild(a),n.setAttribute("isPickable","false"),r.appendChild(n),r}function m(t,e,r){var n,o=f(r);return n=e.selector?t.select(e.selector):t,Object.keys(e.attributes).forEach(t=>{var r=f(e.attributes[t]);n.attr(t,t=>r(o(t)))}),t}function f(t){return"function"==typeof t?t:e=>t}function h(t){return new b(t)}function b(t="body"){this.x3=d3.select(t).append("x3d").style("height","93%").style("width","100%").style("border","none"),this.x3.append("background").attr("groundColor",y.getColor(C.sky)).attr("skyColor",y.getColor(C.ground)),this.scene=this.x3.append("scene"),this.viewpoint=this.scene.append("viewpoint");var e=this;return document.onload=function(){e.runtime=e.x3.node().runtime},this}var y={encodePos:function(r){return t(e(r))},toTuple:e,getColor:function(e){var r=d3.color(e);return t([A(r.r),A(r.g),A(r.b)])},getTransparency:function(t){return 1-d3.color(t).opacity}},A=d3.scaleLinear().domain([0,255]);r.color={selector:"shape appearance material",attributes:{diffuseColor:t=>y.getColor(t),transparency:t=>y.getTransparency(t)}},r.position={attributes:{translation:t=>y.encodePos(t)}},Object.setPrototypeOf(n,r),n.size={selector:"transform shape box",attributes:{size:t=>y.encodePos(t)}},Object.setPrototypeOf(o,r),o.height={selector:"transform shape pyramid",attributes:{height:t=>t}},o.xtop={selector:"transform shape pyramid",attributes:{xtop:t=>t}},o.ytop={selector:"transform shape pyramid",attributes:{ytop:t=>t}},o.xbottom={selector:"transform shape pyramid",attributes:{xbottom:t=>t}},o.ybottom={selector:"transform shape pyramid",attributes:{ybottom:t=>t}},Object.setPrototypeOf(a,r),a.emissivecolor={selector:"transform shape appearance material",attributes:{emissivecolor:t=>y.getColor(t),transparency:t=>y.getTransparency(t)}},a.points={selector:"transform shape lineset coordinate",attributes:{point:t=>t.map(y.encodePos).join(" ")}},Object.setPrototypeOf(i,r),i.font={selector:"transform shape text fontstyle",attributes:{family:t=>t}},i.size={selector:"transform shape text fontstyle",attributes:{size:t=>t}},i.orientation={selector:"transform",attributes:{rotation:t=>t}},Object.setPrototypeOf(d,r),d.points=[{selector:"shape cylinder",attributes:{height:t=>l(t)}},{attributes:{translation:t=>p(t)}},{attributes:{rotation:t=>u(t)}}];var x=function(t,e){return Array.isArray(t)?t.forEach(t=>m(this,t,e)):m(this,t,e),this};d3.selection.prototype.set=x,d3.transition.prototype.set=x;var g="rgba(255, 255, 255, 1)",C={sky:g,ground:g,leaf:"rgba(255, 160, 80, 1)",nodeCollapsed:"rgba(80, 130, 255, 1)",nodeExpanded:"rgba(130, 180, 255, 1)",hierarchy:"rgba(250, 249, 237, 0.3)",line:"gray",lineHighlighted:"#cc0099"};return b.prototype=h.prototype={use:function(t){return t.attach(this),this},setCenter:function(t){return d3.select("viewpoint").attr("centerOfRotation",y.encodePos(t)),this}},{shape:r,box:n,pyramid:o,line:a,text:i,pipe:d,utils:y,vis:h,palette:C}});